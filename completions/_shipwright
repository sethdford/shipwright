#compdef shipwright sw cct
# ╔═══════════════════════════════════════════════════════════════════════════╗
# ║  Shipwright — Zsh tab completions                                       ║
# ║  Auto-install to ~/.zsh/completions/ during shipwright init             ║
# ╚═══════════════════════════════════════════════════════════════════════════╝

_shipwright() {
    local -a commands
    commands=(
        'agent:Agent management (recruit, swarm, standup, guild, oversight)'
        'quality:Quality & review (code-review, security-audit, testgen, hygiene)'
        'observe:Observability (vitals, dora, retro, stream, activity, replay)'
        'release:Release & deploy (release, release-manager, changelog, deploy)'
        'intel:Intelligence (predict, intelligence, strategic, optimize)'
        'init:Quick tmux setup — one command, no prompts'
        'setup:Guided setup — prerequisites, init, doctor'
        'session:Create a new tmux window for a Claude team'
        'status:Show dashboard of running teams and agents'
        'ps:Show running agent processes and status'
        'logs:View and search agent pane logs'
        'templates:Manage team composition templates'
        'doctor:Validate your setup and check for issues'
        'cleanup:Clean up orphaned team sessions'
        'reaper:Automatic pane cleanup when agents exit'
        'upgrade:Check for updates from the repo'
        'loop:Continuous agent loop — run until goal is achieved'
        'pipeline:Full delivery pipeline — idea to production'
        'worktree:Manage git worktrees for agent isolation'
        'prep:Repo preparation — generate .claude/ configs'
        'daemon:Issue watcher — auto-process GitHub issues'
        'fleet:Multi-repo fleet — orchestrate daemons'
        'memory:Persistent memory — learn from every pipeline run'
        'cost:Cost intelligence — track tokens, budgets'
        'db:SQLite persistence — events, runs, developers'
        'fix:Bulk fix — apply a fix across multiple repos'
        'dashboard:Fleet Command — real-time dashboard'
        'jira:Jira sync — bidirectional issue sync'
        'linear:Linear sync — bidirectional issue sync'
        'tracker:Issue tracker — configure Linear/Jira'
        'heartbeat:Agent heartbeat — write/check/list'
        'checkpoint:Checkpoints — save/restore agent state'
        'webhook:GitHub webhooks — instant processing'
        'decompose:Issue decomposer — analyze complexity'
        'connect:Team connect — sync local state'
        'remote:Remote machines — manage distributed workers'
        'launchd:Process supervision — auto-start on boot'
        'docs:Documentation keeper — auto-sync docs'
        'tmux:tmux health — doctor, install, fix'
        'github:GitHub context — repo metadata'
        'checks:GitHub checks — CI check runs'
        'deploys:Deployments — deployment history'
        'pr:PR lifecycle — auto-review, merge'
        'context:Context engine — gather context'
        'help:Show help message'
        'version:Show version'
    )

    local -a pipeline_cmds daemon_cmds fleet_cmds memory_cmds cost_cmds
    local -a templates_cmds worktree_cmds tracker_cmds heartbeat_cmds
    local -a checkpoint_cmds connect_cmds remote_cmds launchd_cmds
    local -a dashboard_cmds github_cmds checks_cmds deploys_cmds docs_cmds
    local -a tmux_cmds decompose_cmds pr_cmds
    local -a agent_cmds quality_cmds observe_cmds release_cmds intel_cmds

    agent_cmds=(
        'recruit:Agent recruitment & talent management'
        'swarm:Dynamic agent swarm management'
        'standup:Automated daily standups'
        'guild:Knowledge guilds & cross-team learning'
        'oversight:Quality oversight board'
    )
    quality_cmds=(
        'code-review:Clean code & architecture analysis'
        'security-audit:Comprehensive security auditing'
        'testgen:Autonomous test generation'
        'hygiene:Repository organization & cleanup'
    )
    observe_cmds=(
        'vitals:Pipeline vitals — real-time scoring'
        'dora:DORA metrics dashboard'
        'retro:Sprint retrospective engine'
        'stream:Live terminal output streaming'
        'activity:Live agent activity stream'
        'replay:Pipeline DVR — view past runs'
        'status:Team status dashboard'
    )
    release_cmds=(
        'release:Release train automation'
        'release-manager:Autonomous release pipeline'
        'changelog:Automated release notes'
        'deploy:Deployments — deployment history'
    )
    intel_cmds=(
        'predict:Predictive risk assessment'
        'intelligence:Intelligence engine analysis'
        'strategic:Strategic intelligence agent'
        'optimize:Self-optimization based on DORA'
    )
    pipeline_cmds=(
        'start:Start a new pipeline run'
        'resume:Resume from last stage'
        'status:Show pipeline progress dashboard'
        'test:Run pipeline test suite'
    )
    daemon_cmds=(
        'start:Start issue watcher'
        'stop:Graceful shutdown'
        'status:Show active pipelines and queue'
        'metrics:DORA/DX metrics dashboard'
        'test:Run daemon test suite'
    )
    fleet_cmds=(
        'start:Start daemons for all repos'
        'stop:Stop all daemons'
        'status:Show fleet-wide status'
        'metrics:Cross-repo DORA metrics'
        'test:Run fleet test suite'
    )
    memory_cmds=(
        'show:Show learned patterns for this repo'
        'search:Search across all memories'
        'stats:Memory usage and coverage'
    )
    cost_cmds=(
        'show:Show cost summary'
        'budget:Manage daily budget'
    )
    templates_cmds=(
        'list:Browse team templates'
        'show:Show template details'
    )
    worktree_cmds=(
        'create:Create git worktree'
        'list:List active worktrees'
        'remove:Remove worktree'
    )
    tracker_cmds=(
        'init:Initialize tracker'
        'status:Show tracker status'
        'sync:Sync issues'
        'test:Run tracker test suite'
    )
    heartbeat_cmds=(
        'write:Write heartbeat'
        'check:Check heartbeat'
        'list:List heartbeats'
        'clear:Clear heartbeats'
    )
    checkpoint_cmds=(
        'save:Save agent state'
        'restore:Restore agent state'
        'list:List checkpoints'
        'delete:Delete checkpoint'
    )
    connect_cmds=(
        'start:Sync to team dashboard'
        'stop:Stop connection'
        'join:Join a team'
        'status:Show connection status'
    )
    remote_cmds=(
        'list:Show remote machines'
        'add:Register a remote'
        'remove:Remove a remote'
        'status:Health check remotes'
        'test:Run remote test suite'
    )
    launchd_cmds=(
        'install:Auto-start on boot'
        'uninstall:Remove services'
        'status:Show service status'
        'test:Run launchd test suite'
    )
    dashboard_cmds=(
        'start:Start dashboard'
        'stop:Stop dashboard'
        'status:Show dashboard status'
    )
    github_cmds=(
        'context:Show GitHub context'
        'security:Show security alerts'
        'blame:Show file ownership'
    )
    checks_cmds=(
        'list:Show check runs'
        'status:Show check status'
        'test:Run checks test suite'
    )
    deploys_cmds=(
        'list:Show deployment history'
        'status:Show deployment status'
        'test:Run deploys test suite'
    )
    docs_cmds=(
        'check:Report stale sections'
        'sync:Regenerate stale sections'
        'wiki:Generate wiki pages'
        'report:Show freshness report'
        'test:Run docs test suite'
    )
    tmux_cmds=(
        'doctor:Check Claude compat'
        'install:Install TPM'
        'fix:Auto-fix issues'
        'reload:Reload config'
        'test:Run tmux test suite'
    )
    decompose_cmds=(
        'analyze:Analyze complexity'
        'create-subtasks:Create subtasks'
    )
    pr_cmds=(
        'review:Auto-review PR'
        'merge:Auto-merge PR'
        'cleanup:Cleanup merged branches'
        'feedback:Get PR feedback'
    )

    _arguments -C \
        '1:command:->command' \
        '*::arg:->args'

    case "$state" in
        command)
            _describe -t commands 'shipwright command' commands
            ;;
        args)
            case "${words[1]}" in
                agent)
                    _describe -t agent-cmds 'agent command' agent_cmds
                    ;;
                quality)
                    _describe -t quality-cmds 'quality command' quality_cmds
                    ;;
                observe)
                    _describe -t observe-cmds 'observe command' observe_cmds
                    ;;
                release)
                    _describe -t release-cmds 'release command' release_cmds
                    ;;
                intel)
                    _describe -t intel-cmds 'intel command' intel_cmds
                    ;;
                pipeline)
                    _describe -t pipeline-cmds 'pipeline command' pipeline_cmds
                    _arguments '*:options:_pipeline_options'
                    ;;
                daemon)
                    _describe -t daemon-cmds 'daemon command' daemon_cmds
                    ;;
                fleet)
                    _describe -t fleet-cmds 'fleet command' fleet_cmds
                    ;;
                memory)
                    _describe -t memory-cmds 'memory command' memory_cmds
                    ;;
                cost)
                    _describe -t cost-cmds 'cost command' cost_cmds
                    ;;
                templates)
                    _describe -t templates-cmds 'templates command' templates_cmds
                    ;;
                worktree)
                    _describe -t worktree-cmds 'worktree command' worktree_cmds
                    ;;
                tracker)
                    _describe -t tracker-cmds 'tracker command' tracker_cmds
                    ;;
                heartbeat)
                    _describe -t heartbeat-cmds 'heartbeat command' heartbeat_cmds
                    ;;
                checkpoint)
                    _describe -t checkpoint-cmds 'checkpoint command' checkpoint_cmds
                    ;;
                connect)
                    _describe -t connect-cmds 'connect command' connect_cmds
                    _arguments '--token[Invite token]:token'
                    ;;
                remote)
                    _describe -t remote-cmds 'remote command' remote_cmds
                    _arguments '--host[Hostname]:host' '--port[SSH port]:port' '--key[SSH key]:file' '--user[SSH user]:user'
                    ;;
                launchd)
                    _describe -t launchd-cmds 'launchd command' launchd_cmds
                    ;;
                dashboard)
                    _describe -t dashboard-cmds 'dashboard command' dashboard_cmds
                    ;;
                github)
                    _describe -t github-cmds 'github command' github_cmds
                    ;;
                checks)
                    _describe -t checks-cmds 'checks command' checks_cmds
                    ;;
                deploys)
                    _describe -t deploys-cmds 'deploys command' deploys_cmds
                    ;;
                docs)
                    _describe -t docs-cmds 'docs command' docs_cmds
                    ;;
                tmux)
                    _describe -t tmux-cmds 'tmux command' tmux_cmds
                    ;;
                decompose)
                    _describe -t decompose-cmds 'decompose command' decompose_cmds
                    ;;
                pr)
                    _describe -t pr-cmds 'pr command' pr_cmds
                    ;;
                prep)
                    _arguments \
                        '--check[Audit existing prep quality]' \
                        '--with-claude[Deep analysis using Claude Code]' \
                        '--verbose[Verbose output]'
                    ;;
                loop)
                    _arguments \
                        '1:goal:' \
                        '--repo[Directory path]:directory:_directories' \
                        '--local[Local-only mode (no GitHub)]' \
                        '--test-cmd[Test command]:command:' \
                        '--max-iterations[Max iterations]:count:' \
                        '--model[Model to use]:model:(opus sonnet haiku)' \
                        '--agents[Number of agents]:count:' \
                        '--audit[Self-reflection each iteration]' \
                        '--audit-agent[Separate auditor]' \
                        '--quality-gates[Quality checks]' \
                        '--definition-of-done[Checklist]:file:_files' \
                        '--resume[Resume interrupted loop]' \
                        '--skip-permissions[Skip prompts]'
                    ;;
                fix)
                    _arguments \
                        '1:goal:' \
                        '--repos[Repository paths]:repos:'
                    ;;
                logs)
                    _arguments \
                        '1:team name:' \
                        '--follow[Tail logs]' \
                        '--lines[Number of lines]:count:' \
                        '--grep[Search pattern]:pattern:'
                    ;;
                cleanup)
                    _arguments \
                        '--force[Kill orphaned sessions]'
                    ;;
                upgrade)
                    _arguments \
                        '--apply[Apply updates]'
                    ;;
                reaper)
                    _arguments \
                        '--watch[Continuous watch mode]'
                    ;;
            esac
            ;;
    esac
}

_pipeline_options() {
    _arguments \
        '--issue[GitHub issue number]:issue:' \
        '--goal[Goal description]:goal:' \
        '--repo[Directory path]:directory:_directories' \
        '--local[Local-only mode (no GitHub)]' \
        '--worktree[Use isolated worktree]' \
        '--template[Pipeline template]:file:_files' \
        '--skip-gates[Auto-proceed all gates]'
}

_shipwright "$@"
