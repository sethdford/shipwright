# ╔═══════════════════════════════════════════════════════════════════════════╗
# ║              CLAUDE CODE TEAMS - TMUX OVERLAY CONFIGURATION                ║
# ║                                                                            ║
# ║  This overlay adds agent-aware pane styling and team keybindings to        ║
# ║  your existing tmux config. It is sourced automatically by tmux.conf       ║
# ║  but can also be used independently:                                       ║
# ║                                                                            ║
# ║    tmux source-file ~/.tmux/claude-teams-overlay.conf                      ║
# ║                                                                            ║
# ║  What this overlay does:                                                   ║
# ║    - Shows agent names in pane borders (pane_title)                        ║
# ║    - Enables aggressive resize for better multi-agent layouts              ║
# ║    - Adds safety bindings to prevent accidentally killing agent panes      ║
# ║    - Provides team-specific keybindings for navigation and management      ║
# ║                                                                            ║
# ║  Convention: Each Claude agent pane should set its title on startup via:   ║
# ║    printf '\033]2;agent-name\033\\'                                        ║
# ║  The cct CLI does this automatically when spawning agent panes.            ║
# ╚═══════════════════════════════════════════════════════════════════════════╝

# ═══════════════════════════════════════════════════════════════════════════
# PANE TITLES - Show agent names in borders
# ═══════════════════════════════════════════════════════════════════════════

# Display pane titles at the top of each pane border
set -g pane-border-status top

# Format: show pane index and title (agent name) with team-aware styling
set -g pane-border-format " #[fg=#00d4ff,bold]#P#[default] │ #{pane_title} "

# ═══════════════════════════════════════════════════════════════════════════
# LAYOUT - Optimize for multi-agent pane layouts
# ═══════════════════════════════════════════════════════════════════════════

# Aggressive resize: let panes resize independently per client
# This prevents smaller terminal clients from constraining team pane sizes
setw -g aggressive-resize on

# ═══════════════════════════════════════════════════════════════════════════
# SAFETY - Confirm before killing agent panes
# ═══════════════════════════════════════════════════════════════════════════

# Override default kill-pane to require confirmation in team windows
# This prevents accidentally terminating a running Claude agent
bind x confirm-before -p "Kill pane #{pane_title}? (y/n)" kill-pane
bind X confirm-before -p "Kill ALL panes in window #W? (y/n)" kill-window

# ═══════════════════════════════════════════════════════════════════════════
# TEAM NAVIGATION
# ═══════════════════════════════════════════════════════════════════════════

# prefix + g → select a pane by agent name (uses choose-tree for visual picking)
bind g display-panes -d 5000

# prefix + G → toggle zoom on current agent pane (focus on one agent's output)
bind G resize-pane -Z

# ═══════════════════════════════════════════════════════════════════════════
# TEAM MANAGEMENT
# ═══════════════════════════════════════════════════════════════════════════

# prefix + M-t → send the same command to all panes (synchronized input)
# Useful for stopping all agents at once, etc.
bind M-t setw synchronize-panes \; display-message "Team sync #{?synchronize-panes,ON,OFF}"

# prefix + M-l → rotate through even-horizontal, even-vertical, tiled layouts
# Useful for reorganizing agent panes
bind M-l next-layout

# prefix + M-s → capture a snapshot of all pane contents (for debugging)
bind M-s run-shell "tmux capture-pane -t {marked} -p > /tmp/claude-pane-capture-$(date +%s).txt && tmux display-message 'Pane captured to /tmp/'"
